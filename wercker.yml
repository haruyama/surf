box: pacificporter/golang:1.11.5-10.13.0
build:
  steps:
    - script:
        name: copy source
        code: |
          mkdir -p $GOPATH/src/github.com/pacificporter
          cp -ar $WERCKER_SOURCE_DIR/ $GOPATH/src/github.com/pacificporter/surf
    - script:
        name: glide install
        cwd: $GOPATH/src/github.com/pacificporter/surf
        code: |
          glide install
    - script:
        name: go vet
        cwd: $GOPATH/src/github.com/pacificporter/surf
        code: |
          go vet $(glide novendor)
    - script:
        name: gosimple
        cwd: $GOPATH/src/github.com/pacificporter/surf
        code: |
          gosimple $(glide novendor)
    - script:
        name: errcheck
        cwd: $GOPATH/src/github.com/pacificporter/surf
        code: |
          errcheck -ignore="Close|Run|Write" ${NOVENDOR}
    - script:
        name: golint
        cwd: $GOPATH/src/github.com/pacificporter/surf
        code: |
          echo -n $(glide novendor) | xargs -d ' ' -L1 golint  | egrep -v 'Id.* should be .*ID|Url| should have comment | comment on exported ' | perl -e 'local $/; $o=<STDIN>; if ($o eq "") {exit(0)}; print $o; exit(1);'
    - script:
        name: gocyclo
        cwd: $GOPATH/src/github.com/pacificporter/surf
        code: |
          gocyclo -over 20 $(glide novendor -x)
    - script:
        name: ineffassign
        cwd: $GOPATH/src/github.com/pacificporter/surf
        code: |
          ineffassign $(glide novendor -x)
    - script:
        name: go test
        cwd: $GOPATH/src/github.com/pacificporter/surf
        code: |
          TZ=Japan go test $(glide novendor)
